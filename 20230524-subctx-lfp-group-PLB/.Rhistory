# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=loudness_lvl)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=loudness_lvl), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
# scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
# scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
# ylim(-0.25, 0.25) +
# xlim(-1, 2.5) +
theme_bw()
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(~is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
group_by(subject_id, run_id, channel, epoch, time, loudness_lvl) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, loudness_lvl) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
# pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
# mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
# group_by(epoch, time) %>%
# summarise(
#   eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
#   eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
# ) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=loudness_lvl)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=loudness_lvl), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
# scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
# scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
# ylim(-0.25, 0.25) +
# xlim(-1, 2.5) +
theme_bw()
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
group_by(subject_id, run_id, channel, epoch, time, loudness_lvl) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, loudness_lvl) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
# pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
# mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
# group_by(epoch, time) %>%
# summarise(
#   eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
#   eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
# ) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=loudness_lvl)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=loudness_lvl), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
# scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
# scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
# ylim(-0.25, 0.25) +
# xlim(-1, 2.5) +
theme_bw()
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
group_by(subject_id, run_id, channel, epoch, time, loudness_lvl) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, loudness_lvl) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
# pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
# mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
# group_by(epoch, time) %>%
# summarise(
#   eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
#   eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
# ) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=loudness_lvl)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=loudness_lvl), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
# scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
# scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
ylim(-0.025, 0.05) +
# xlim(-1, 2.5) +
theme_bw()
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = loudness_lvl) %>%
group_by(subject_id, run_id, channel, epoch, time, clrby) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, clrby) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
# pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
# mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
# group_by(epoch, time) %>%
# summarise(
#   eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
#   eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
# ) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=clrby)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=clrby), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
# scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
# scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
ylim(-0.025, 0.05) +
# xlim(-1, 2.5) +
theme_bw()
source("/Volumes/Nexus4/DBS/groupanalyses/task-lombard/20230524-subctx-lfp-group-PLB/A04v3_analyze_all_trials_bandpower_table.R")
fname <- 'grandavg-eeg_split-by-loud3rds_task-difference-responsive-only_facet-epoch_no-lmtime-valueBSLN_channelwise' # statistically significant only
ggsave(file=glue('{PATH_FIG}/A04v4_05_{fname}.pdf'), dpi=300, width=4, height=3, units='in')
ggsave(file=glue('{PATH_FIG}/A04v4_05_{fname}.pdf'), dpi=300, width=6, height=3, units='in')
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = noise_type) %>%
group_by(subject_id, run_id, channel, epoch, time, clrby) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, clrby) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
# pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
# mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
# group_by(epoch, time) %>%
# summarise(
#   eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
#   eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
# ) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=clrby)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=clrby), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
ylim(-0.025, 0.05) +
# xlim(-1, 2.5) +
theme_bw()
fname <- 'grandavg-eeg_split-by-noise-type_task-difference-responsive-only_facet-epoch_no-lmtime-valueBSLN_channelwise' # statistically significant only
fname <- 'grandavg-eeg_split-by-noise-type_task-difference-responsive-only_lmtime-no-valueBSLN_channelwise' # statistically significant only
ggsave(file=glue('{PATH_FIG}/A04v4_05_{fname}.pdf'), dpi=300, width=6, height=3, units='in') # height=25 for multi-channel plots
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = noise_type) %>%
group_by(subject_id, run_id, channel, epoch, time, clrby) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, clrby) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
group_by(epoch, time) %>%
summarise(
eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=clrby)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=clrby), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
ylim(-0.025, 0.05) +
# xlim(-1, 2.5) +
theme_bw()
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = noise_type) %>%
group_by(subject_id, run_id, channel, epoch, time, noise_type) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, noise_type) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
group_by(epoch, time) %>%
summarise(
eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=noise_type)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=clrby), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
ylim(-0.025, 0.05) +
# xlim(-1, 2.5) +
theme_bw()
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = noise_type) %>%
group_by(subject_id, run_id, channel, epoch, time, noise_type) %>%
summarise(
eeg_mean = mean(eeg_smoothed, na.rm = TRUE),
eeg_sem = sd(eeg_smoothed, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
group_by(time, epoch, noise_type) %>% # arrange(.by_group=TRUE) %>%
# summarize(n = n())
summarise(
eeg_mean_grp = mean(eeg_mean, na.rm = TRUE),
eeg_sem_grp = sd(eeg_mean, na.rm = TRUE) / sqrt(n()),  # Standard error of the mean
n = n(),
) %>% rename(eeg_mean = eeg_mean_grp, eeg_sem = eeg_sem_grp) %>%
pivot_wider(values_from = eeg_mean, names_from = noise_type) %>%
mutate(eeg_mean_NOISEminusQUIET = NOISE - QUIET) %>%
group_by(epoch, time) %>%
summarise(
eeg_mean = mean(eeg_mean_NOISEminusQUIET, na.rm = TRUE),
eeg_sem = sd(eeg_mean_NOISEminusQUIET, na.rm = TRUE) / sqrt(n())  # Standard error of the mean
) %>%
# arrange(desc(eeg_smoothed))
# filter(is.na(eeg_smoothed))
ggplot(aes(x=time, color=noise_type)) +
# geom_rect(data = EPOCHS_MEAN_TIMES, aes(xmin = start+0.1, xmax = end-0.1, ymin = -Inf, ymax = Inf, inherit.aes = FALSE, fill = 'grey'), alpha = 0.2) +  # Add shaded regions
#  +
geom_ribbon(aes(ymin = eeg_mean - eeg_sem, ymax = eeg_mean + eeg_sem, fill=noise_type), alpha = 0.3, linewidth=0) +  # Shaded SE ribbon
geom_line(aes(y=eeg_mean)) +
# facet_grid(subject_id+run_id+channel~., scales = 'free') +
facet_grid(.~., scales = 'free_y') +
# stat_summary(geom = "ribbon", fun.data = "mean_cl_normal", aes(fill = factor(noise_type)), alpha=0.3, linewidth=0) +
scale_color_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
scale_fill_manual(values = color_map_conditions$hex, breaks=color_map_conditions$name) +
geom_hline(yintercept = 0) +
coord_cartesian(expand = FALSE) +
ylim(-0.025, 0.05) +
# xlim(-1, 2.5) +
theme_bw()
tmp_plot <-
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = noise_type)
tmp_plot
tmp_plot <-
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( !(sig=="none") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = noise_type)
tmp_plot <-
lmtime_results_channelwise %>%
ungroup() %>%
# filter(row_number() %in% sample.int(100, 15)) %>%
semi_join(lmcondition_results_channelwise %>% filter( (sig=="epoch") & !str_detect(channel, 'ecog')),
by = join_by(subject_id, run_id, channel)) %>% # get significant channels only
unnest(data) %>%
# mutate(noise_type = lag(noise_type, 5, default = last(noise_type))) %>% # shuffle
# filter(subject_id!="DM1019") %>%
group_by(subject_id, run_id, channel, trial_id) %>%
# mutate(eeg = (value - value_BSLN) / value_BSLN) %>%
mutate(eeg = value_residualtime) %>%
mutate(time = floor(timewarp_t0*50)/50) %>%
filter(!is.na(loudness_lvl)) %>%
# mutate(time = cut(timewarp_t0_epoch, breaks=time_breaks, labels=time_breaks)) %>% # cut(timewarp_t0_epoch, breaks=100, labels=FALSE)) %>%
mutate(eeg_smoothed = signal::sgolayfilt(eeg, p = 3, n = 51)) %>%  # p = polynomial order, n = window size (odd number)
# mutate(eeg_smoothed = eeg) %>%  # p = polynomial order, n = window size (odd number)
# filter(time>-1 & time<3) %>%
mutate(clrby = noise_type)
tmp_plot
